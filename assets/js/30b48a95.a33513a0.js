"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[9184],{3905:(e,n,a)=>{a.r(n),a.d(n,{MDXContext:()=>p,MDXProvider:()=>c,mdx:()=>h,useMDXComponents:()=>d,withMDXComponents:()=>s});var t=a(67294);function r(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function i(){return i=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(e[t]=a[t])}return e},i.apply(this,arguments)}function l(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function o(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?l(Object(a),!0).forEach((function(n){r(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function m(e,n){if(null==e)return{};var a,t,r=function(e,n){if(null==e)return{};var a,t,r={},i=Object.keys(e);for(t=0;t<i.length;t++)a=i[t],n.indexOf(a)>=0||(r[a]=e[a]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)a=i[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=t.createContext({}),s=function(e){return function(n){var a=d(n.components);return t.createElement(e,i({},n,{components:a}))}},d=function(e){var n=t.useContext(p),a=n;return e&&(a="function"==typeof e?e(n):o(o({},n),e)),a},c=function(e){var n=d(e.components);return t.createElement(p.Provider,{value:n},e.children)},f={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},u=t.forwardRef((function(e,n){var a=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,p=m(e,["components","mdxType","originalType","parentName"]),s=d(a),c=r,u=s["".concat(l,".").concat(c)]||s[c]||f[c]||i;return a?t.createElement(u,o(o({ref:n},p),{},{components:a})):t.createElement(u,o({ref:n},p))}));function h(e,n){var a=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=a.length,l=new Array(i);l[0]=u;var o={};for(var m in n)hasOwnProperty.call(n,m)&&(o[m]=n[m]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var p=2;p<i;p++)l[p]=a[p];return t.createElement.apply(null,l)}return t.createElement.apply(null,a)}u.displayName="MDXCreateElement"},27716:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>m,contentTitle:()=>l,default:()=>d,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var t=a(83117),r=(a(67294),a(3905));const i={state:"experimental"},l="Programs",o={unversionedId:"spec/definition/program",id:"spec/definition/program",title:"Programs",description:"A program consists of:",source:"@site/../doc/spec/definition/program.md",sourceDirName:"spec/definition",slug:"/spec/definition/program",permalink:"/docs/spec/definition/program",draft:!1,editUrl:"https://github.com/facebook/fbthrift/blob/main/thrift/website/../doc/spec/definition/program.md",tags:[],version:"current",frontMatter:{state:"experimental"},sidebar:"sidebar",previous:{title:"Interface Types",permalink:"/docs/spec/definition/interface"},next:{title:"Tolerance",permalink:"/docs/spec/definition/tolerance"}},m={},p=[{value:"Universal Names",id:"universal-names",level:2},{value:"Includes",id:"includes",level:2},{value:"Package",id:"package",level:2},{value:"Namespaces",id:"namespaces",level:2},{value:"Definitions",id:"definitions",level:2},{value:"Abstract Syntax Tree (AST)",id:"abstract-syntax-tree-ast",level:2}],s={toc:p};function d(e){let{components:n,...a}=e;return(0,r.mdx)("wrapper",(0,t.Z)({},s,a,{components:n,mdxType:"MDXLayout"}),(0,r.mdx)("h1",{id:"programs"},"Programs"),(0,r.mdx)("p",null,"A program consists of:"),(0,r.mdx)("ol",null,(0,r.mdx)("li",{parentName:"ol"},"optional ",(0,r.mdx)("a",{parentName:"li",href:"#includes"},"includes"),","),(0,r.mdx)("li",{parentName:"ol"},"the ",(0,r.mdx)("a",{parentName:"li",href:"#package"},"package")," for the program,"),(0,r.mdx)("li",{parentName:"ol"},"optional ",(0,r.mdx)("a",{parentName:"li",href:"#namespaces"},"namespace")," overrides, and"),(0,r.mdx)("li",{parentName:"ol"},(0,r.mdx)("a",{parentName:"li",href:"#definitions"},"definitions"),".")),(0,r.mdx)("h2",{id:"universal-names"},"Universal Names"),(0,r.mdx)("p",null,"A Universal Name uniquely identifies a Thrift ",(0,r.mdx)("a",{parentName:"p",href:"/docs/spec/definition/"},"definition"),", regardless of which program it is defined in. It ",(0,r.mdx)("strong",{parentName:"p"},"must")," be a valid ",(0,r.mdx)("a",{parentName:"p",href:"https://tools.ietf.org/html/rfc3986"},"URI")," that meets the following criteria:"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("strong",{parentName:"li"},"Must not"),' have a scheme; "fbthrift://" is implied.'),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("strong",{parentName:"li"},"Must")," include a domain name as the 'authority', with at least 2 domain labels."),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("strong",{parentName:"li"},"Must")," include a path (with at least 2 path segments for a definition)."),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("strong",{parentName:"li"},"Must not")," have a query or a fragment."),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("strong",{parentName:"li"},"Must")," be in the following canonical/normalized form:",(0,r.mdx)("ul",{parentName:"li"},(0,r.mdx)("li",{parentName:"ul"},"Domain name labels ",(0,r.mdx)("strong",{parentName:"li"},"must")," be lowercase ASCII letters, numbers, -, or _."),(0,r.mdx)("li",{parentName:"ul"},"Path segments ",(0,r.mdx)("strong",{parentName:"li"},"must")," be ASCII letters, numbers, -, or _.")))),(0,r.mdx)("h2",{id:"includes"},"Includes"),(0,r.mdx)("p",null,"Thrift allows including other Thrift files to use any of its consts and types. These can be referenced from another file by prepending the filename to the definition's name (i.e., ",(0,r.mdx)("inlineCode",{parentName:"p"},"Filename.Identifier"),")."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre"},'IncludeDeclaration:\n    include "{Path}/{Filename}.thrift"\n')),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("a",{parentName:"li",href:"https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap03.html#tag_03_271"},"Path")," and ",(0,r.mdx)("a",{parentName:"li",href:"https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap03.html#tag_03_170"},"Filename")," ",(0,r.mdx)("strong",{parentName:"li"},"must")," be valid POSIX portable pathname and filename.")),(0,r.mdx)("p",null,(0,r.mdx)("em",{parentName:"p"},"Note")," a program cannot include multiple files with the same file name, only differing by path."),(0,r.mdx)("h2",{id:"package"},"Package"),(0,r.mdx)("p",null,"A package declaration defines the default ",(0,r.mdx)("a",{parentName:"p",href:"#universal-names"},"Universal Name")," and optional annotations, under which all ",(0,r.mdx)("a",{parentName:"p",href:"#definitions"},"definitions")," in the program are declared:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre"},'PackageDeclaration:\n    {Annotations}\n    package "Domain/Identifier{/Identifier}";\n')),(0,r.mdx)("p",null,"For example:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre"},'include "thrift/annotations/thrift.thrift"\n\n@thrift.Testing // Indicates all definitions in the program are for tests only.\npackage "test.dev/testing"\n\n // Has the universal name "test.dev/testing/MyInt" and inherits `@thrift.Testing`.\ntypedef int MyInt\n')),(0,r.mdx)("h2",{id:"namespaces"},"Namespaces"),(0,r.mdx)("p",null,"Language-specific overrides for the native module/package/namespace/etc abstraction, represented as a list of identifiers (names)."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre"},"NamespaceDeclaration:\n    namespace Language Identifier{.Identifier};\n")),(0,r.mdx)("p",null,"All Thrift implementations ",(0,r.mdx)("strong",{parentName:"p"},"must")," define a default mapping from package to 'namespace'. For example, the following mapping are used for officially-supported Thrift languages:"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},"cpp2: ",(0,r.mdx)("inlineCode",{parentName:"li"},"{reverse(domain)[1:]}.{path}")),(0,r.mdx)("li",{parentName:"ul"},"python: ",(0,r.mdx)("inlineCode",{parentName:"li"},"{reverse(domain)[1:]}.{path[:-2] if path[-1] == filename else path}")),(0,r.mdx)("li",{parentName:"ul"},"hack: ",(0,r.mdx)("inlineCode",{parentName:"li"},"{path}")),(0,r.mdx)("li",{parentName:"ul"},"java: ",(0,r.mdx)("inlineCode",{parentName:"li"},"{reverse(domain)}.{path}"))),(0,r.mdx)("p",null,"For example,"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre"},'package "domain.com/path/to/file"\n')),(0,r.mdx)("p",null,"This package name implies the following namespaces:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre"},"namespace cpp2 domain.path.to.file\nnamespace python domain.path.to\nnamespace py3 domain.path.to\nnamespace hack path.to.file\nnamespace php path.to.file\nnamespace java.swift com.domain.path.to.file\n")),(0,r.mdx)("h2",{id:"definitions"},"Definitions"),(0,r.mdx)("p",null,(0,r.mdx)("a",{parentName:"p",href:"/docs/spec/"},"Definitions")," ",(0,r.mdx)("strong",{parentName:"p"},"may")," have an unstructured annotation ",(0,r.mdx)("inlineCode",{parentName:"p"},"thrift.uri")," as an ",(0,r.mdx)("a",{parentName:"p",href:"#universal-names"},"Universal Name"),". It ",(0,r.mdx)("strong",{parentName:"p"},"must")," be globally unique. If a ",(0,r.mdx)("a",{parentName:"p",href:"#universal-names"},"Universal Name")," is not specified, one will be generated using a package ",(0,r.mdx)("inlineCode",{parentName:"p"},"{package}/{identifier}"),". For example,"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre"},'package "example.com/path/to/file"\n\nstruct Foo {\n  1: i32 field;\n}\n')),(0,r.mdx)("p",null,"This is equivalent to"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre"},'package "example.com/path/to/file"\n\nstruct Foo {\n  1: i32 field;\n} (thrift.uri = "example.com/path/to/file/Foo")\n')),(0,r.mdx)("h2",{id:"abstract-syntax-tree-ast"},"Abstract Syntax Tree (AST)"),(0,r.mdx)("p",null,"The parsed Thrift code is represented as an ",(0,r.mdx)("a",{parentName:"p",href:"https://github.com/facebook/fbthrift/tree/main/thrift/compiler/ast"},"Abstract Syntax Tree")," that starts from ",(0,r.mdx)("inlineCode",{parentName:"p"},"t_program")," for each thrift file."))}d.isMDXComponent=!0}}]);