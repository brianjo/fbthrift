<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-spec/definition/annotation">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Annotations | Facebook Thrift</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.internalfb.com/docs/spec/definition/annotation"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Annotations | Facebook Thrift"><meta data-rh="true" name="description" content="Structured Annotations"><meta data-rh="true" property="og:description" content="Structured Annotations"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.internalfb.com/docs/spec/definition/annotation"><link data-rh="true" rel="alternate" href="https://www.internalfb.com/docs/spec/definition/annotation" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.internalfb.com/docs/spec/definition/annotation" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.afc07cdd.css">
<link rel="preload" href="/assets/js/runtime~main.1abcbc59.js" as="script">
<link rel="preload" href="/assets/js/main.b3203846.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Facebook Thrift Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="Facebook Thrift Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Facebook Thrift</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/fbthrift" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/spec/">Specification</a><button aria-label="Toggle the collapsible sidebar category &#x27;Specification&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/spec/about">Specification Format</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/spec/conformance/">Conformance</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/spec/definition/">Definitions</a><button aria-label="Toggle the collapsible sidebar category &#x27;Definitions&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/spec/definition/annotation">Annotations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/spec/definition/compatibility">Compatibility</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/spec/definition/data">Data Types</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/spec/definition/exception">Errors and Exceptions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/spec/definition/interface">Interface Types</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/spec/definition/program">Programs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/spec/definition/tolerance">Tolerance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/spec/definition/value">Values</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/spec/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/spec/idl">Interface Definition Language (IDL)</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/spec/protocol/">Protocols</a><button aria-label="Toggle the collapsible sidebar category &#x27;Protocols&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/guide/">User Guide</a><button aria-label="Toggle the collapsible sidebar category &#x27;User Guide&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/experimental/">Experimental Features</a><button aria-label="Toggle the collapsible sidebar category &#x27;Experimental Features&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/beta/">Beta Features</a><button aria-label="Toggle the collapsible sidebar category &#x27;Beta Features&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/cpp/">C++</a><button aria-label="Toggle the collapsible sidebar category &#x27;C++&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/internals/">Internals</a><button aria-label="Toggle the collapsible sidebar category &#x27;Internals&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/troubleshooting">Troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/debugging">Debugging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/references/">References</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/releases">Releases</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/contribution-guide">Contribution Guide</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Annotations</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="structured-annotations">Structured Annotations<a class="hash-link" href="#structured-annotations" title="Direct link to heading">​</a></h2><p>Structured annotations are structural constants attached to the named IDL entities, typically representing some metadata or altering the compiler behavior. They are specified via <code>@Annotation{key1=value1, key2=value2, ...}</code> syntax before the <a href="/docs/spec/">Definitions</a>. Each definition may have several annotations with no duplicates allowed. <code>@Annotation</code> can be used as a syntactic sugar for <code>@Annotation{}</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="grammar">Grammar<a class="hash-link" href="#grammar" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">StructuredAnnotations ::= NonEmptyStructuredAnnotationList | &quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NonEmptyStructuredAnnotationList ::=</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    NonEmptyStructuredAnnotationList StructuredAnnotation</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | StructuredAnnotation</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">StructuredAnnotation ::= &quot;@&quot; ConstStruct | &quot;@&quot; ConstStructType</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="examples">Examples<a class="hash-link" href="#examples" title="Direct link to heading">​</a></h3><p>Here&#x27;s a comprehensive list of various annotated entities.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct FirstAnnotation {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  1: string name;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  2: i64 count = 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct SecondAnnotation {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  2: i64 total = 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  3: SecondAnnotation recurse (cpp.ref = &quot;True&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  4: bool is_cool;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@FirstAnnotation{name=&quot;my_type&quot;}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">typedef string annotated_string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@FirstAnnotation{name=&quot;my_struct&quot;, count=3}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@SecondAnnotationstruct</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">MyStruct {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  @SecondAnnotation{}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  5: annotated_string tag;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@FirstAnnotationexception</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">MyException {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  1: string message;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@SecondAnnotation{total=1, is_cool=true}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">union MyUnion {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  1: i64 int_value;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  2: string string_value;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@SecondAnnotation{total=4, recurse=SecondAnnotation{total=5}}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">service MyService {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  @SecondAnnotation</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  i64 my_function(2: annotated_string param);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@FirstAnnotation{name=&quot;shiny&quot;}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">enum MyEnum {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  UNKNOWN = 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  @SecondAnnotation</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  FIRST = 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@FirstAnnotation{name=&quot;my_hack_enum&quot;}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">const map&lt;string, string&gt; MyConst = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;ENUMERATOR&quot;: &quot;value&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="unstructured-annotations-deprecated">Unstructured Annotations (Deprecated)<a class="hash-link" href="#unstructured-annotations-deprecated" title="Direct link to heading">​</a></h2><p>Unstructured annotations are structured as key-value pairs where the key is a string and the value is either a string or a const structure. They may be applied to <a href="/docs/spec/">definitions</a> in the Thrift language, following that construct.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Annotations ::=</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;(&quot; AnnotationList [&quot;,&quot; | &quot;;&quot;] &quot;)&quot; |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;(&quot; &quot;)&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">AnnotationList ::=</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  AnnotationList (&quot;,&quot; | &quot;;&quot;) Annotation |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Annotation</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Annotation ::=</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Name [ &quot;=&quot; ( Name | StringLiteral ) ]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If a value is not present, then the default value of <code>&quot;1&quot;</code> (a string) is assumed.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="scope-annotations">Scope Annotations<a class="hash-link" href="#scope-annotations" title="Direct link to heading">​</a></h2><p>How to specify what types of definitions an annotation can be applied to. See <a href="https://github.com/facebook/fbthrift/blob/v2022.07.18.00/thrift/annotation/scope.thrift#L24-L57" target="_blank" rel="noopener noreferrer">scope.thrift</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="transitive-annotations">Transitive Annotations<a class="hash-link" href="#transitive-annotations" title="Direct link to heading">​</a></h2><p>Applies effects of sibling annotations. See <a href="https://github.com/facebook/fbthrift/blob/v2022.07.18.00/thrift/annotation/scope.thrift#L71-L94" target="_blank" rel="noopener noreferrer">scope.thrift</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="standard-annotations">Standard Annotations<a class="hash-link" href="#standard-annotations" title="Direct link to heading">​</a></h2><p>The standard Thrift annotation library is a set of structured annotations (i.e. <code>cpp.thrift</code>, <code>meta.thrift</code>, and more) that is located in <code>thrift/annotation</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="c-annotations">C++ annotations<a class="hash-link" href="#c-annotations" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cpptype">cpp.type<a class="hash-link" href="#cpptype" title="Direct link to heading">​</a></h4><ul><li>Where to use: field type</li><li>Value: a complete type</li><li>Example:</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cpp_include &quot;&lt;unordered_map&gt;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cpp_include &quot;folly/sorted_vector_types.h&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cpp_include &quot;CustomMap.h&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">typedef list&lt;i64&gt; Type1 (cpp.type = &quot;folly::small_vector&lt;int64_t&gt;&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">typedef map&lt;string, Foo&gt; Type2 (cpp.type = &quot;std::unordered_map&lt;std::string, Foo&gt;&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">typedef binary (cpp.type = &quot;std::unique_ptr&lt;folly::IOBuf&gt;&quot;) IOBufPtr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct Foo {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  1: Type1 field1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  2: Type2 field2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  3: map&lt;i64, double&gt; (cpp.type = &quot;CustomMap&quot;) field3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  4: IOBufPtr iobuf_ptr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This completely replaces the underlying type of a thrift for a custom implementation. It is also possible to add <code>cpp_include</code> to bring in additional data structures and use them in conjunction with <code>cpp.type</code>. It is required that the custom type matches the specified Thrift type even for internal container types. Prefer types that can leverage<code>reserve(size_t)</code> as Thrift makes uses these optimizations.<em>Special Case</em>: <code>cpp.type=&quot;std::unique_ptr&lt;folly::IOBuf&gt;&quot;</code>: This annotation can be used to define a type as <code>IOBuf</code> or <code>unique_ptr&lt;IOBuf&gt;</code> so that you can leverage Thrift2&#x27;s support for zero-copy buffer manipulation through <code>IOBuf</code>.During deserialization, thrift receives a buffer that is used to allocate the appropriate fields in the struct. When using smart pointers, instead of making a copy of the data, it only modifies the pointer to point to the address that is used by the buffer.</p><p>The custom type must provide the following methods</p><ul><li><em><code>list</code></em>: <em><code>push_back(T)</code></em></li><li><em><code>map</code></em>: <em><code>insert(std::pair&lt;T1, T2&gt;)</code></em></li><li><em><code>set</code></em>: <em><code>insert(T)</code></em></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cpptemplate">cpp.template<a class="hash-link" href="#cpptemplate" title="Direct link to heading">​</a></h4><ul><li>Where to use: container field type</li><li>Value: a template</li><li>Example:</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cpp_include &quot;folly/sorted_vector_types.h&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct Example {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  1: set&lt;i64&gt; (cpp.template = &quot;folly::sorted_vector_set&quot;) shards;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Specifies a template to use for the container type to replace the default. It somewhat overlaps with <code>cpp.type</code> but the advantage is probably you just need to specify the template type once in the annotation, without repeating the inner types.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cppref">cpp.Ref<a class="hash-link" href="#cppref" title="Direct link to heading">​</a></h4><ul><li>Where to use: field name</li><li>Type:<ul><li><code>cpp.RefType.Unique</code> : <code>std::unique_ptr&lt;T&gt;</code></li><li><code>cpp.RefType.Shared</code> : <code>std::shared_ptr&lt;const T&gt; </code></li><li><code>cpp.RefType.SharedMutable</code> : <code>std::shared_ptr&lt;T&gt;</code>:</li></ul></li><li>Example:</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct BinaryTree {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  @cpp.Ref{type = cpp.RefType.Unique}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  1: BinaryTree left;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  @cpp.Ref</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  2: BinaryTree right;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  @cpp.Ref{type = cpp.RefType.SharedMutable}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  3: BinaryTree parent;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  @cpp.Ref{type = cpp.RefType.Shared}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  4: BinaryTree root;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  5: i16 item;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Makes a field a reference, not a value and Thrift generates a <code>std::unique_ptr/std::shared_ptr</code> for the annotated field, not a value. This annotation is added to support recursive types. However, you can also use it to turn a field from a value to a pointer. <code>@cpp.Ref</code> is equivalent having type<code>@cpp.RefType.Unique</code>. All <code>@cpp.Ref</code> fields <strong>should be</strong> optional.</p><p>NOTE: A struct may transitively contain itself as a field only if at least one of the fields in the inclusion chain is either an optional Ref field or a container. Otherwise the struct would have infinite size. See <a href="https://github.com/facebook/fbthrift/blob/main/thrift/test/Recursive.thrift" target="_blank" rel="noopener noreferrer"><code>thrift/test/Recursive.thrift</code></a> for examples. </p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cppnoncopyable-and-cppnoncomparable">cpp.noncopyable and cpp.noncomparable<a class="hash-link" href="#cppnoncopyable-and-cppnoncomparable" title="Direct link to heading">​</a></h4><ul><li>Where to use: struct/union/exception</li><li>Value: None</li><li>Example:</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">typedef binary (cpp.type = &quot;folly::IOBuf&quot;) IOBuf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">union NonCopyableUnion {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  1: i32 a,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  2: IOBuf buf,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">} (cpp.noncopyable, cpp.noncomparable)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is to avoid generating copy constructor/copy assignment constructor and overridden equality operator for types. You rarely need to use them.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cppdeclare_hash-and-cppdeclare_equal_to">cpp.declare_hash and cpp.declare_equal_to<a class="hash-link" href="#cppdeclare_hash-and-cppdeclare_equal_to" title="Direct link to heading">​</a></h4><ul><li>Where to use: struct</li><li>Value: None</li></ul><p>Adds a <code>std::hash</code> and <code>std::equal_to</code> specialization for the Thrift struct. You need to provide your own hash and equal_to implementation. Use this annotation if you want to use your Thrift struct as the key type of <code>std::unordered_map</code> or other unordered associative containers.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cppcache">cpp.cache<a class="hash-link" href="#cppcache" title="Direct link to heading">​</a></h4><ul><li>Where to use: method parameter, must be a string and only one of the parameters can have this annotation</li><li>Value: None</li></ul><p>This is added by the SMC team to support their custom processor, which caches response and uses the parameter annotated by <code>cpp.cache</code> as the key.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cppcoroutine">cpp.coroutine<a class="hash-link" href="#cppcoroutine" title="Direct link to heading">​</a></h4><ul><li>Where to use: method</li><li>Value: None</li><li>Example:</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">service MyService {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  void m1() (cpp.coroutine);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Enable coroutine generation. See [<!-- -->[Thrift/ImplementingAServer/]<!-- -->] for more information.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="priority">priority<a class="hash-link" href="#priority" title="Direct link to heading">​</a></h4><ul><li>Where to use: method</li><li>Value: None</li><li>Example:</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">service MyService {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  void m1() (priority = HIGH);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  void m2();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Designate a priority level for the annotated method. By default all methods have the same priority level. This is only used in C++ when <code>ThriftServer</code> uses a <code>PriorityThreadManager</code>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="message">message<a class="hash-link" href="#message" title="Direct link to heading">​</a></h4><ul><li>Where to use: exception</li><li>Value: name of a string field</li><li>Example:</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">exception MyException {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  1: string errorMessage</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">} (message = &quot;errorMessage&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The annotation&#x27;s value should be the name of a string field in the exception. The code generator then generates a constructor which uses a string to initialize that string field. The exception class&#x27;s <code>what()</code> method is overridden to returns the content of that string field.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="no_default_comparators">no_default_comparators<a class="hash-link" href="#no_default_comparators" title="Direct link to heading">​</a></h4><ul><li>Where to use: struct</li><li>Value: none</li></ul><p>Do not generate a default comparator even if the struct is orderable.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="thread">thread<a class="hash-link" href="#thread" title="Direct link to heading">​</a></h4><ul><li>Where to use: method</li><li>Value: eb or tm (default)</li><li>Example:</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">service MyService {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  int m1() (thread = &#x27;eb&#x27;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  int m2();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Causes the request to be executed on the event base thread directly instead of rescheduling onto a thread manager thread, provided the async<em>eb</em> handler method is implemented. You should only execute the request on the event base thread if it is very fast and you have measured that rescheduling is a substantial chunk of your service&#x27;s CPU usage. If a request executing on the event base thread blocks or takes a long time, all other requests sharing the same event base are affected and latency will increase significantly. This is only supported in C++. We strongly discourage the use of this annotation unless strictly necessary. You will have to implement the harder-to-use async<em>eb</em> handler method; implementing any other method will cause the rescheduling regardless of this annotation. This also disables queue timeouts, an important form of overload protection.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cppindirection">cpp.indirection<a class="hash-link" href="#cppindirection" title="Direct link to heading">​</a></h4><ul><li>Where to use: field type</li><li>Value: a method to call from the base type</li><li>Example:</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Thrift file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">typedef i64 (cpp.type = &quot;Seconds&quot;, cpp.indirection) seconds</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct MyStruct {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  1: seconds s;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// C++ file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct Seconds : private boost::totally_ordered&lt;Seconds&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  FBTHRIFT_CPP_DEFINE_MEMBER_INDIRECTION_FN(number);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  std::int64_t number = 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Seconds() = default;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Seconds(std::int64_t number_) : number(number_) {}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  bool operator==(Seconds that) const { return number == that.number; }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  bool operator&lt;(Seconds that) const { return number &lt; that.number; }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Together with <code>cpp.type</code> annotation, this annotation defines a new type and uses the indirect method to access its value.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="frozen-and-frozen2">frozen and frozen2<a class="hash-link" href="#frozen-and-frozen2" title="Direct link to heading">​</a></h4><ul><li>Where to use: struct, not exception. This is also supported through code generator flag and currently only used through code generator flag.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cppmethods-deprecated">cpp.methods (deprecated)<a class="hash-link" href="#cppmethods-deprecated" title="Direct link to heading">​</a></h4><ul><li>Where to use: struct</li><li>Value: valid code</li><li>Example:</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct MyStruct {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    1: i32 anInteger;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  } (</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    cpp.methods = &quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      public:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        std::string toString() const;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Insert some code into the Thrift generated header file.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cppenum_type">cpp.enum_type<a class="hash-link" href="#cppenum_type" title="Direct link to heading">​</a></h4><ul><li>Where to use: enum</li><li>Value: an integer type for c++ to use as the underlying type of enum</li><li>Example:</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">enum TermIdType {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> GENERIC_FP96 = 0,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> PREFIX_USERID = 1,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">} (cpp.enum_type = &quot;int&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="deprecated">deprecated<a class="hash-link" href="#deprecated" title="Direct link to heading">​</a></h4><ul><li>Where to use: struct/member</li><li>Value: None or a custom message.</li></ul><p>This will mark the struct or member as deprecated and will issue a warning when compiling.Note that if other Thrift files include a Thrift file with deprecated annotations, those files will be treated as using these fields and propagate warnings when included. If <code>a.thrift</code> marks struct <code>foo</code> as deprecated, <code>b.thrift</code> includes <code>a.thrift</code>, and <code>c.cpp</code> includes <code>b.thrift</code>, deprecated warnings concerning foo will be raised when building <code>c.cpp</code> even if the file doesn&#x27;t actually use <code>foo</code>.</p><ul><li>Example:</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Default struct message: &quot;class MyStruct is deprecated&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct MyStruct {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 1: i32 a</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">} (deprecated)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct MyStruct3 {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 1: i32 a = 0 (deprecated)  // Default member message: &quot;i32 a is deprecated&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">} (deprecated = &quot;This is not longer supported&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cppminimizepadding">cpp.MinimizePadding<a class="hash-link" href="#cppminimizepadding" title="Direct link to heading">​</a></h4><ul><li>Where to use: struct</li><li>Value: none</li><li>Example:</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">include &quot;thrift/annotation/cpp.thrift&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@cpp.MinimizePadding</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct Padded {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  1: required byte small</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  2: required i64 big</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  3: required i16 medium</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  4: required i32 biggish</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  5: required byte tiny</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This annotation enables reordering of fields in the generated C++ struct to minimize padding. This is achieved by placing the fields in the order of decreasing alignments. The order of fields with the same alignment is preserved.For example, the C++ fields for the <code>Padded</code> Thrift struct above will be generated in the following order:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">int64_t big;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">int32_t biggish;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">int16_t medium;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">int8_t small;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">int8_t tiny;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>which gives the size of 16 bytes compared to 32 bytes if <code>cpp.MinimizePadding</code> was not specified.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cppname">cpp.name<a class="hash-link" href="#cppname" title="Direct link to heading">​</a></h4><ul><li>Where to use: member</li><li>Value: string with a valid C++ identifier</li><li>Example:</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct Error {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  1: string message</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  2: i32 errno (cpp.name = &quot;error_code&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This annotation renames all C++ entities (member variables, parameter names, etc.) generated from the Thrift field. For example, the <code>errno</code> field in the <code>Error</code> struct will be renamed to <code>error_code</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">class Error {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> public:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Error() : error_code(0) {}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  std::string message;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  int32_t error_code;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In most cases a much better solution is to rename the problematic Thrift field itself. Only use the <code>cpp.name</code> annotation if such renaming is problematic, e.g. when the field name appears in code as a string, particularly when using JSON serialization, and it is hard to change all usage sites.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cppmixin">cpp.mixin<a class="hash-link" href="#cppmixin" title="Direct link to heading">​</a></h4><ul><li>Where to use: member</li><li>Value: none</li><li>Example:</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct Mixin1 { 1: i32 field1 }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct Mixin2 { 1: i32 field2 }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct Foo {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  1: Mixin1 m1 (cpp.mixin);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  2: Mixin2 m2 (cpp.mixin);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  3: i32 field3;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then in C++ we could access fields in Mixin from Foo</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Foo f;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">f.field1_ref();  // Access field1 in Mixin1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Read more: Thrift/Mixins</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cpplazy">cpp.Lazy<a class="hash-link" href="#cpplazy" title="Direct link to heading">​</a></h4><ul><li>Where to use: field</li><li>Value: <code>true</code></li><li>Example:</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct Foo {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  1: list&lt;i32&gt; small_field;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  2: list&lt;i32&gt; large_field (cpp.experimental.lazy);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Lazily deserialize large field on first access.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Foo foo;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apache::thrift::CompactSerializer::deserialize(serializedData, foo);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// large_field is lazy field, it will be deserialized on first access</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// The data will be deserialized in method call large_field_ref()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LOG(INFO) &lt;&lt; foo.large_field_ref()-&gt;size();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Result will be cached, we won&#x27;t deserialize again</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LOG(INFO) &lt;&lt; foo.large_field_ref()-&gt;size();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Read more: Thrift/Lazy/</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cpppackisset">cpp.PackIsset<a class="hash-link" href="#cpppackisset" title="Direct link to heading">​</a></h4><ul><li>Where to use: field</li><li>Value: <code>none</code></li><li>Example:</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">include &quot;thrift/annotation/cpp.thrift&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@cpp.PackIsset</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct Foo {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  1: optional i32 field1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  2: i32 field2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Read more: Thrift/Isset_Bitpacking/</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cppadapter">cpp.Adapter<a class="hash-link" href="#cppadapter" title="Direct link to heading">​</a></h4><ul><li>Where to use: field, typedef</li><li>Value: name of adapter</li><li>Example:</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// in C++ Header</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct BitsetAdapter {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  static std::bitset&lt;32&gt; fromThrift(std::uint32_t t) { return {t}; }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  static std::uint32_t toThrift(std::bitset&lt;32&gt; t) { return t.to_ullong(); }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">};</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// In thrift file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct Foo {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  @cpp.Adapter{name = &quot;BitsetAdapter&quot;}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  1: i32 flags;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// in C++ file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Foo foo;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">foo.flags()-&gt;set(0); // set 0th bit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>More detail: Thrift/Thrift_Guide/Adapter/</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="annotations-for-c-allocator-awareness">Annotations for C++ Allocator Awareness<a class="hash-link" href="#annotations-for-c-allocator-awareness" title="Direct link to heading">​</a></h4><p>Example C++:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">using MyAlloc = std::scoped_allocator_adaptor&lt;folly::SysArenaAllocator&lt;char&gt;&gt;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">template &lt;class T&gt; using MyVector = std::vector&lt;T, MyAlloc&gt;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">template &lt;class K, class V&gt; using MyMap = std::map&lt;K, V, std::less&lt;K&gt;, MyAlloc&gt;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Thrift IDL usage example (assuming <code>cpp_include</code> the above):</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct aa_struct {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  1: list&lt;i32&gt; (cpp.use_allocator, cpp.template = &quot;MyVector&quot;) aa_list;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  2: map&lt;i32, i32&gt; (cpp.use_allocator, cpp.template = &quot;MyMap&quot;) aa_map;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  3: set&lt;i32&gt; not_aa_set;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">} (cpp.allocator = &quot;MyAlloc&quot;, cpp.allocator_via = &quot;aa_list&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cppallocator">cpp.allocator<a class="hash-link" href="#cppallocator" title="Direct link to heading">​</a></h4><ul><li>Where to use: struct</li><li>Value: string name of a type conforming to the <a href="https://en.cppreference.com/w/cpp/named_req/Allocator" target="_blank" rel="noopener noreferrer">C++ named requirement &quot;Allocator&quot;</a></li></ul><p>Declares that this is an allocator-aware structure, using the specified C++ allocator type. When this annotation is present, the Thrift compiler will generate additional code sufficient to meet the <a href="https://en.cppreference.com/w/cpp/named_req/AllocatorAwareContainer" target="_blank" rel="noopener noreferrer">C++ named requirement &quot;AllocatorAwareContainer&quot;:</a></p><ul><li><code>allocator_type</code> typedef</li><li><code>get_allocator()</code> function</li><li>Three &quot;allocator-extended&quot; constructors</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cppuse_allocator">cpp.use_allocator<a class="hash-link" href="#cppuse_allocator" title="Direct link to heading">​</a></h4><ul><li>Where to use: member</li><li>Value: none</li></ul><p>Indicates that the structure&#x27;s allocator should be passed down to this member at construction time.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cppallocator_via">cpp.allocator_via<a class="hash-link" href="#cppallocator_via" title="Direct link to heading">​</a></h4><ul><li>Where to use: struct</li><li>Value: string with a valid C++ identifier which is a member field in this struct</li></ul><p>This is a structure size optimization. The naive implementation of <code>get_allocator()</code> requires an additional data member to “remember” the allocator. With <code>cpp.allocator_via</code>, we instead delegate this responsibility to one of the allocator-aware fields.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="hack-annotations">Hack annotations<a class="hash-link" href="#hack-annotations" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="hackadapter">hack.adapter<a class="hash-link" href="#hackadapter" title="Direct link to heading">​</a></h4><ul><li>Where to use: field type</li><li>Value: a class that implements the <code>IThriftAdapter</code> interface</li><li>Example:</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// in thrift:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct Document {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  1: i32 (hack.adapter = &#x27;\TimestampToTimeAdapter&#x27;) created_time;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// thrift compiler will generate this for you:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class Document implements \IThriftStruct {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  public Time $created_time;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// in hack:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">final class TimestampToTimeAdapter implements IThriftAdapter {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  const type TThriftType = int;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  const type THackType = Time;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  public static function fromThrift(int $seconds)[]: Time {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return Time::fromEpochSeconds($seconds);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  public static function toThrift(Time $time): int {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return $hack_value-&gt;asFullSecondsSinceEpoch();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// elsewhere in hack:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">function timeSinceCreated(Document $doc): Duration {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // $doc-&gt;created_time is of type Time</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  return Duration::between(Time::now(), $doc-&gt;created_time);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This completely replaces the underlying type of a thrift for a custom implementation and uses the specified adapter to convert to and from the underlying Thrift type during (de)serialization.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="hackattributes">hack.attributes<a class="hash-link" href="#hackattributes" title="Direct link to heading">​</a></h4><ul><li>Where to use: field or struct type</li><li>Value: add attributes like <code>JSEnum</code> to structs or fields</li><li>Example:</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// In thrift</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">enum MyEnum {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ALLOWED = 1,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  THIS_IS_ALLOWED  =  2,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  THIS_IS_ALLOWED_2 = 3,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  hack.attributes=</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;\JSEnum(shape(&#x27;name&#x27; =&gt; &#x27;MyEnum&#x27;)),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    \GraphQLEnum(&#x27;MyEnum&#x27;, &#x27;Description for my enum&#x27;,)&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct MyThriftStruct {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  1: string foo (hack.attributes = &quot;FieldAttribute&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  2: string bar;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  3: string baz;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">} (hack.attributes = &quot;ClassAttribute&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//thrift compiler will generate this for you</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;&lt;\JSEnum(shape(&#x27;name&#x27; =&gt; &#x27;MyEnum&#x27;)),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">\GraphQLEnum(&#x27;MyEnum&#x27;, &#x27;Description for my enum&#x27;,)&gt;&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">enum MyEnum: int {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> ALLOWED = 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> THIS_IS_ALLOWED = 2;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> THIS_IS_ALLOWED_2 = 3;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;&lt;ClassAttribute&gt;&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class MyThriftStruct implements \IThriftStruct {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> ....</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> &lt;&lt;FieldAttribute&gt;&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> public string $foo;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> ....</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="python-annotations">Python annotations<a class="hash-link" href="#python-annotations" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="pythonadapter">python.Adapter<a class="hash-link" href="#pythonadapter" title="Direct link to heading">​</a></h4><ul><li>Where to use: field, typedef</li><li>Value: a class that implements the <a href="https://github.com/facebook/fbthrift/blob/main/thrift/lib/python/adapter.pyi" target="_blank" rel="noopener noreferrer">Adapter</a></li><li>Example:</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// In Python file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class DatetimeAdapter(Adapter[int, datetime]):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @classmethod</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    def from_thrift(cls, original: int) -&gt; datetime:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return datetime.fromtimestamp(original)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @classmethod</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    def to_thrift(cls, adapted: datetime) -&gt; int:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return int(adapted.timestamp())</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// In thrift file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct Foo {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  @python.Adapter{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name = &quot;DatetimeAdapter&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    typeHint = &quot;datetime.datetime&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  1: i32 dt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// In python file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">foo = Foo()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">assert isinstance(foo.dt, datetime)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">assert foo.dt.timestamp() == 0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This completely replaces the underlying type of a thrift for a custom implementation and uses the specified adapter to convert to and from the underlying Thrift type during (de)serialization.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="thrift-annotations">Thrift annotations<a class="hash-link" href="#thrift-annotations" title="Direct link to heading">​</a></h3><p>Thrift annotations work in all officially supported languages.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="thriftbox">thrift.Box<a class="hash-link" href="#thriftbox" title="Direct link to heading">​</a></h4><ul><li>Where to use: optional field name</li><li>Value: <code>true</code></li><li>Example:</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct RecList {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  @thrift.Box</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  1: optional RecList next;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This indicates that a subobject should be allocated separately (e.g. because it is large and infrequently set).</p><p>NOTE: The APIs and initialization behavior are same as normal field, but different from <code>@cpp.Ref</code>. e.g.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct Foo {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  1: optional i32 normal;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  @thrift.Box</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  2: optional i32 boxed;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  @cpp.Ref</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  3: optional i32 referred;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>in C++</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Foo foo;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">EXPECT_FALSE(foo.normal().has_value()); // okay</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">EXPECT_FALSE(foo.boxed().has_value()); // okay</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">EXPECT_FALSE(foo.referred().has_value()); // build failure: std::unique_ptr doesn&#x27;t have has_value method</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">EXPECT_EQ(*foo.normal(), 0); // throw bad_field_access exception</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">EXPECT_EQ(*foo.boxed(), 0); // throw bad_field_access exception</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">EXPECT_EQ(*foo.referred(), 0); // okay, field has value by default</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="thriftserializeinfieldidorder">thrift.SerializeInFieldIdOrder<a class="hash-link" href="#thriftserializeinfieldidorder" title="Direct link to heading">​</a></h4><p>Serialize fields in field id ascending order instead of fields declaration order. This makes serialization result deterministic after swapping fields. In addition, it can reduce payload size only for compact protocol. Example</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">@thrift.SerializeInFieldIdOrder</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">struct Foo {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  2: byte a;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  1: byte b;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This reduces serialized data size from 5 bytes to 4 bytes for compact protocol.</p><p>Why? Compact protocol stored delta of field id, instead of actual field id in payload. When field is serialized out of field id order, delta=0 will be written, followed with actual field id, thus when field is serialized out of field id order, it uses more bytes for field id.</p><p>NOTE: This annotation won&#x27;t reduce payload size for other protocols.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/fbthrift/blob/main/thrift/website/../doc/spec/definition/annotation.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/spec/definition/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Definitions</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/spec/definition/compatibility"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Compatibility</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#structured-annotations" class="table-of-contents__link toc-highlight">Structured Annotations</a><ul><li><a href="#grammar" class="table-of-contents__link toc-highlight">Grammar</a></li><li><a href="#examples" class="table-of-contents__link toc-highlight">Examples</a></li></ul></li><li><a href="#unstructured-annotations-deprecated" class="table-of-contents__link toc-highlight">Unstructured Annotations (Deprecated)</a></li><li><a href="#scope-annotations" class="table-of-contents__link toc-highlight">Scope Annotations</a></li><li><a href="#transitive-annotations" class="table-of-contents__link toc-highlight">Transitive Annotations</a></li><li><a href="#standard-annotations" class="table-of-contents__link toc-highlight">Standard Annotations</a><ul><li><a href="#c-annotations" class="table-of-contents__link toc-highlight">C++ annotations</a></li><li><a href="#hack-annotations" class="table-of-contents__link toc-highlight">Hack annotations</a></li><li><a href="#python-annotations" class="table-of-contents__link toc-highlight">Python annotations</a></li><li><a href="#thrift-annotations" class="table-of-contents__link toc-highlight">Thrift annotations</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/">Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/thrift" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://engineering.fb.com/2014/02/20/open-source/under-the-hood-building-and-open-sourcing-fbthrift/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/facebook/fbthrift" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/data-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Data Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/cookie-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cookie Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></a></div><div class="footer__copyright">Copyright © 2022 Facebook, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.1abcbc59.js"></script>
<script src="/assets/js/main.b3203846.js"></script>
</body>
</html>