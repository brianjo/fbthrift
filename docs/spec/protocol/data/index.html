<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-spec/protocol/data">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Data Protocols | Facebook Thrift</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.internalfb.com/fbthrift/docs/spec/protocol/data"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Data Protocols | Facebook Thrift"><meta data-rh="true" name="description" content="How data is (de)serialized."><meta data-rh="true" property="og:description" content="How data is (de)serialized."><link data-rh="true" rel="icon" href="/fbthrift/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.internalfb.com/fbthrift/docs/spec/protocol/data"><link data-rh="true" rel="alternate" href="https://www.internalfb.com/fbthrift/docs/spec/protocol/data" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.internalfb.com/fbthrift/docs/spec/protocol/data" hreflang="x-default"><link rel="stylesheet" href="/fbthrift/assets/css/styles.afc07cdd.css">
<link rel="preload" href="/fbthrift/assets/js/runtime~main.18b8a5ef.js" as="script">
<link rel="preload" href="/fbthrift/assets/js/main.8d55481e.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/fbthrift/"><div class="navbar__logo"><img src="/fbthrift/img/logo.svg" alt="Facebook Thrift Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/fbthrift/img/logo.svg" alt="Facebook Thrift Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Facebook Thrift</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/fbthrift/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/fbthrift" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fbthrift/docs/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fbthrift/docs/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/fbthrift/docs/spec/">Specification</a><button aria-label="Toggle the collapsible sidebar category &#x27;Specification&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fbthrift/docs/spec/about">Specification Format</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fbthrift/docs/spec/conformance/">Conformance</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/fbthrift/docs/spec/definition/">Definitions</a><button aria-label="Toggle the collapsible sidebar category &#x27;Definitions&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fbthrift/docs/spec/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fbthrift/docs/spec/idl">Interface Definition Language (IDL)</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/fbthrift/docs/spec/protocol/">Protocols</a><button aria-label="Toggle the collapsible sidebar category &#x27;Protocols&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/fbthrift/docs/spec/protocol/channel">Channels</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/fbthrift/docs/spec/protocol/data">Data Protocols</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/fbthrift/docs/spec/protocol/interface/">Interface Protocols</a><button aria-label="Toggle the collapsible sidebar category &#x27;Interface Protocols&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/fbthrift/docs/guide/">User Guide</a><button aria-label="Toggle the collapsible sidebar category &#x27;User Guide&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/fbthrift/docs/experimental/">Experimental Features</a><button aria-label="Toggle the collapsible sidebar category &#x27;Experimental Features&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/fbthrift/docs/beta/">Beta Features</a><button aria-label="Toggle the collapsible sidebar category &#x27;Beta Features&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/fbthrift/docs/cpp/">C++</a><button aria-label="Toggle the collapsible sidebar category &#x27;C++&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/fbthrift/docs/internals/">Internals</a><button aria-label="Toggle the collapsible sidebar category &#x27;Internals&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fbthrift/docs/troubleshooting">Troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fbthrift/docs/debugging">Debugging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fbthrift/docs/references/">References</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fbthrift/docs/releases">Releases</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fbthrift/docs/contribution-guide">Contribution Guide</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Data Protocols</h1><p>How <a href="/fbthrift/docs/spec/definition/data">data</a> is (de)serialized.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="thrift-types">Thrift Types<a class="hash-link" href="#thrift-types" title="Direct link to heading">​</a></h2><p>There are 13 different Thrift types that can appear in the serialized output.</p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>STOP</td><td>STOP does not represent data, it is used to indicate that no fields are left in a serialized struct.</td></tr><tr><td>BOOL</td><td>Boolean</td></tr><tr><td>BYTE</td><td>8-bit signed integer</td></tr><tr><td>DOUBLE</td><td>Double precision floating point number</td></tr><tr><td>I16</td><td>16-bit signed integer</td></tr><tr><td>I32</td><td>32-bit signed integer or a Thrift enum</td></tr><tr><td>I64</td><td>64-bit signed integer</td></tr><tr><td>STRING</td><td>A String</td></tr><tr><td>STRUCT</td><td>A Thrift struct or union</td></tr><tr><td>MAP</td><td>Key-value mapping</td></tr><tr><td>LIST</td><td>List of Thrift values</td></tr><tr><td>SET</td><td>Set of Thrift values</td></tr><tr><td>FLOAT</td><td>Single precision floating point number</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="serialization-formats">Serialization Formats<a class="hash-link" href="#serialization-formats" title="Direct link to heading">​</a></h2><p>Each serialization format encodes the above Thrift types in a different way.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="binary-protocol">Binary Protocol<a class="hash-link" href="#binary-protocol" title="Direct link to heading">​</a></h3><p>The Binary protocol produces data in a non-human readable format.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="type-codes">TYPE CODES<a class="hash-link" href="#type-codes" title="Direct link to heading">​</a></h4><table><thead><tr><th>Type</th><th>Code</th></tr></thead><tbody><tr><td>STOP</td><td><code>0x00</code></td></tr><tr><td>BOOL</td><td><code>0x02</code></td></tr><tr><td>BYTE</td><td><code>0x03</code></td></tr><tr><td>DOUBLE</td><td><code>0x04</code></td></tr><tr><td>I16</td><td><code>0x06</code></td></tr><tr><td>I32</td><td><code>0x08</code></td></tr><tr><td>I64</td><td><code>0x0A</code></td></tr><tr><td>STRING</td><td><code>0x0B</code></td></tr><tr><td>STRUCT</td><td><code>0x0C</code></td></tr><tr><td>MAP</td><td><code>0x0D</code></td></tr><tr><td>SET</td><td><code>0x0E</code></td></tr><tr><td>LIST</td><td><code>0x0F</code></td></tr><tr><td>FLOAT</td><td><code>0x13</code></td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="structs">STRUCTS<a class="hash-link" href="#structs" title="Direct link to heading">​</a></h4><p>A struct is serialized as a sequence of fields. Each field consists of an 8-bit type code (from the table above), a 16-bit field ID, and then the serialized value. The size of the serialized value depends on the value type. At the end, a STOP (<code>0x00</code>) is written; there is no field id following the STOP code.</p><table><thead><tr><th>Type Code</th><th>Field ID</th><th>Value</th></tr></thead><tbody><tr><td>8 Bits</td><td>16 Bits</td><td>Variable</td></tr></tbody></table><p>Unions are serialized in the same way, but instead of having a sequence of fields, they contain exactly one field.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="bool">BOOL<a class="hash-link" href="#bool" title="Direct link to heading">​</a></h4><p>Booleans are serialized as 8-bit values where <code>0x00</code> is False and <code>0x01</code> is True</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="numeric-types">NUMERIC TYPES<a class="hash-link" href="#numeric-types" title="Direct link to heading">​</a></h4><p>The Thrift numeric types are <code>byte</code> (<code>i8</code>), <code>i16</code>, <code>i32</code>, <code>i64</code>, <code>float</code>, and <code>double</code>. These are all serialized using their big-endian n-bit binary representations.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="string">STRING<a class="hash-link" href="#string" title="Direct link to heading">​</a></h4><p>Strings are encoded using a 32-bit length followed by a sequence of 8-bit characters</p><table><thead><tr><th>Length</th><th>Payload</th></tr></thead><tbody><tr><td>32-bit</td><td>Length * 8-bit</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="listset">LIST/SET<a class="hash-link" href="#listset" title="Direct link to heading">​</a></h4><p>Lists and Sets are serialized in exactly the same way. First, the type code of the inner elements is written, then the signed 32-bit length, then the elements. Negative length values are invalid.</p><table><thead><tr><th>Type Code</th><th>Length</th><th>Payload</th></tr></thead><tbody><tr><td>8-bit</td><td>32-bit</td><td>Length * Variable</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="map">MAP<a class="hash-link" href="#map" title="Direct link to heading">​</a></h4><p>Maps are serialized using the 8-bit type codes of the key and value types followed by the length and payload. The payload contains the key value pairs. Length is signed 32-bit; negative values are invalid.</p><table><thead><tr><th>Key Type Code</th><th>Value Type Code</th><th>Length</th><th>Key 1</th><th>Value 1</th><th>...</th><th>Key n</th><th>Value n</th></tr></thead><tbody><tr><td>8-bit</td><td>8-bit</td><td>32-bit</td><td>Variable</td><td>Variable</td><td></td><td>Variable</td><td>Variable</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="compact-protocol">Compact Protocol<a class="hash-link" href="#compact-protocol" title="Direct link to heading">​</a></h3><p>The Compact protocol is similar to binary protocol, but some values are encoded so as to use fewer bytes. In particular, integral types are encoded using the <a href="https://l.facebook.com/l.php?u=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Fencoding&amp;h=AT0fFXtpm2VAb2FPLDl4g0p0TYi-JFoAW58CVsKuE5GJub43Dy-V2LP_rrxsXHzByrC2JCVIf0QVQnvFoeYj1K1RyMDbg8f1oX2-uI6uoGTcsxpBDlIUXesMcEOhCgLWfakjX1jQmtnFqwASFso" target="_blank" rel="noopener noreferrer">varint</a> format.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="type-codes-1">TYPE CODES<a class="hash-link" href="#type-codes-1" title="Direct link to heading">​</a></h4><table><thead><tr><th>Type</th><th>Code</th></tr></thead><tbody><tr><td>STOP</td><td><code>0x0</code></td></tr><tr><td>BOOL (True)</td><td><code>0x1</code></td></tr><tr><td>BOOL (False)</td><td><code>0x2</code></td></tr><tr><td>BYTE</td><td><code>0x3</code></td></tr><tr><td>I16</td><td><code>0x4</code></td></tr><tr><td>I32</td><td><code>0x5</code></td></tr><tr><td>I64</td><td><code>0x6</code></td></tr><tr><td>DOUBLE</td><td><code>0x7</code></td></tr><tr><td>STRING</td><td><code>0x8</code></td></tr><tr><td>LIST</td><td><code>0x9</code></td></tr><tr><td>SET</td><td><code>0xA</code></td></tr><tr><td>MAP</td><td><code>0xB</code></td></tr><tr><td>STRUCT</td><td><code>0xC</code></td></tr><tr><td>FLOAT</td><td><code>0xD</code></td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="structs-1">STRUCTS<a class="hash-link" href="#structs-1" title="Direct link to heading">​</a></h4><p>A struct is serialized as a sequence of fields.
Each field consists of a 4-bit field offset and a 4-bit type code. If the field offset is non-zero then it is added to the previous field ID that was written to obtain the current field ID (starting at 0). If it is 0, then the field ID is encoded as a variable length 16-bit integer. Boolean fields are encoded in the type code.
Type code (from the table above), a 16-bit field ID, and then the serialized value. The size of the serialized value depends on the value type. At the end, STOP (<code>0x00</code>) is written; there is no additional field ID after the STOP code, even if the field offset is 0.</p><table><thead><tr><th>Field Offset</th><th>Type Code</th><th>Value</th></tr></thead><tbody><tr><td>4 Bits</td><td>4 Bits</td><td>Variable</td></tr></tbody></table><p>OR</p><table><thead><tr><th>Field Offset</th><th>Type Code</th><th>Field ID</th><th>Value</th></tr></thead><tbody><tr><td><code>0x0</code></td><td>4 Bits</td><td>Variable</td><td>Variable</td></tr></tbody></table><p>Unions are serialized in the same way, but instead of having a sequence of fields, they contain exactly one field.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="bool-1">BOOL<a class="hash-link" href="#bool-1" title="Direct link to heading">​</a></h4><p>Booleans that are field values are encoded in the type code, so they have no additional serialization. If the boolean is part of collection (list, map, or set), then it is encoded as an 8-bit value where <code>0x02</code> is False and <code>0x01</code> is True.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="integral-types-larger-than-1-byte">INTEGRAL TYPES LARGER THAN 1 BYTE<a class="hash-link" href="#integral-types-larger-than-1-byte" title="Direct link to heading">​</a></h4><p>The Integral types that are larger than 1 Byte (<code>i16</code>, <code>i32</code>, and <code>i64</code>) are encoded using the Varint format.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="other-numeric-type">OTHER NUMERIC TYPE<a class="hash-link" href="#other-numeric-type" title="Direct link to heading">​</a></h4><p>The remaining Thrift numeric types (<code>byte</code>, <code>float</code>, and <code>double</code>) are serialized in the same way as in binary protocol.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="string-1">STRING<a class="hash-link" href="#string-1" title="Direct link to heading">​</a></h4><p>Strings are encoded using a variable-sized length followed by a sequence of 8-bit characters</p><table><thead><tr><th>Length</th><th>Payload</th></tr></thead><tbody><tr><td>Variable</td><td>Length * 8-bit</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="listset-1">LIST/SET<a class="hash-link" href="#listset-1" title="Direct link to heading">​</a></h4><p>Lists and Sets are serialized in exactly the same way. The first byte contains the length (if less than 16) and the type code of the inner elements. If the length is at least 16, then it is encoded as a variable length integer. The serialized elements come next.
First, the type code of the inner elements is written, then the 32-bit length, then the elements.</p><table><thead><tr><th>Length</th><th>Type Code</th><th>Payload</th></tr></thead><tbody><tr><td>4-bit</td><td>4-bit</td><td>Length * Variable</td></tr></tbody></table><p>OR</p><table><thead><tr><th>Filler</th><th>Type Code</th><th>Length</th><th>Payload</th></tr></thead><tbody><tr><td><code>0xF</code></td><td>4-bit</td><td>Variable</td><td>Length * Variable</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="map-1">MAP<a class="hash-link" href="#map-1" title="Direct link to heading">​</a></h4><p>Maps contain a variable encoded length followed by the key and value types encoded in a single byte. Next comes the payload which is encoded in a similar way to the Binary protocol.</p><table><thead><tr><th>Length</th><th>Key Type</th><th>Value Type</th><th>Key 1</th><th>Value 1</th><th>...</th><th>Key n</th><th>Value n</th></tr></thead><tbody><tr><td>Variable</td><td>4-bit</td><td>4-bit</td><td>Variable</td><td>Variable</td><td></td><td>Variable</td><td>Variable</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="varint-encoding">Varint Encoding<a class="hash-link" href="#varint-encoding" title="Direct link to heading">​</a></h4><p>Varint encoding is a variable length encoding for integer values.
Unsigned integers are simplest. They are divided into 7-bit groups, from least to most significant, until there are no more non-zero groups. Each group is encoded as <code>1xxxxxxx</code> until the last group which is <code>0xxxxxxx</code>. So <code>0x12</code> - <code>00010010</code> in binary - would be literally encoded that way, since it&#x27;s only a single group. <code>0x37f0</code> is <code>00_1111101_1110000</code> in binary (using <code>_</code> as a visual separator to show the 7 bit groups), so would be encoded as <code>1_1110000</code> <code>0_1111101</code> (again, <code>_</code> as visual separator).
Signed integers could be treated the same as unsigned, but it would result in all negative values being treated as large positive numbers, with correspondingly large encodings. It would be better to encode numbers with small absolute values more compactly, regardless of sign. Varint does this via &quot;zigzag&quot; encoding, where all numbers are mapped to a positive value before encoding:</p><table><thead><tr><th>Original</th><th>Encoded as</th></tr></thead><tbody><tr><td>0</td><td>0</td></tr><tr><td>-1</td><td>1</td></tr><tr><td>1</td><td>2</td></tr><tr><td>-2</td><td>3</td></tr><tr><td>2</td><td>4</td></tr></tbody></table><p>Or more generally: <code>(x &lt;&lt; 1) ^ (x &gt;&gt;&gt; (bits-1))</code> where <code>bits</code> is the size of the value in bits, and <code>&gt;&gt;&gt;</code> is an arithmetic (sign-extending) shift.
Reversing this is <code>(x &gt;&gt; 1) ^ -(x &amp; 1)</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="handling-unknown-fields">Handling Unknown Fields<a class="hash-link" href="#handling-unknown-fields" title="Direct link to heading">​</a></h3><p>If a decoder encounters an unknown field id while decoding a struct/union, it can continue by skipping that value and resuming with the rest of the stream. To allow this, fields and containers (map, set, list) contain the type code of the unknown type.
For non-compound types, skipping the value is trivial.
For compound types (struct/union and containers), skipping the value is a matter of skipping each field/entry; if a field/entry is also compound then the process is recursive.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="other-protocols">Other Protocols<a class="hash-link" href="#other-protocols" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="frozen2">Frozen2<a class="hash-link" href="#frozen2" title="Direct link to heading">​</a></h3><p>Frozen2 serializes data into a contiguous chunk of buffer, using its associated <em>layout</em>. <em>Layout</em> files are autogenerated from Thrift struct definition, and describes to the library what fields the struct contains.</p><p>A contiguous buffer means several advantages:</p><ul><li>For offline use (serializing Thrift struct to disk, etc.), <code>mmap</code>able data.</li><li>To read values from buffer after serialization, location of the value is already known (think of a C struct), so values can be extracted in-place. Using specialized API is sometimes required.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="debug-protocol">Debug Protocol<a class="hash-link" href="#debug-protocol" title="Direct link to heading">​</a></h3><p>This protocol prints the Thrift object as a human readable, nicely indented string. It is write only now, you cannot deserialize from such a string. There is no guarantee that the format won&#x27;t change -- it might be evolved in a non-backward compatible way. It should only be used for logging.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="deprecated">Deprecated<a class="hash-link" href="#deprecated" title="Direct link to heading">​</a></h2><ul><li>JSON. This protocol serializes Thrift objects into JSON objects (see <a href="/fbthrift/docs/experimental/yaml">yaml</a>).</li><li>SimpleJSON. This protocol is similar with JSON, it is simpler because it doesn&#x27;t output verbose field type (see <a href="/fbthrift/docs/experimental/yaml">yaml</a>).</li></ul><ul><li>Phpserialize. This protocol serializes Thrift objects into PHP&#x27;s &quot;serialize&quot; format. It is write only now, you cannot deserialize from PHP.</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/fbthrift/blob/main/thrift/website/../doc/spec/protocol/data.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/fbthrift/docs/spec/protocol/channel"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Channels</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/fbthrift/docs/spec/protocol/interface/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Interface Protocols</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#thrift-types" class="table-of-contents__link toc-highlight">Thrift Types</a></li><li><a href="#serialization-formats" class="table-of-contents__link toc-highlight">Serialization Formats</a><ul><li><a href="#binary-protocol" class="table-of-contents__link toc-highlight">Binary Protocol</a></li><li><a href="#compact-protocol" class="table-of-contents__link toc-highlight">Compact Protocol</a></li><li><a href="#handling-unknown-fields" class="table-of-contents__link toc-highlight">Handling Unknown Fields</a></li></ul></li><li><a href="#other-protocols" class="table-of-contents__link toc-highlight">Other Protocols</a><ul><li><a href="#frozen2" class="table-of-contents__link toc-highlight">Frozen2</a></li><li><a href="#debug-protocol" class="table-of-contents__link toc-highlight">Debug Protocol</a></li></ul></li><li><a href="#deprecated" class="table-of-contents__link toc-highlight">Deprecated</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/fbthrift/docs/">Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/thrift" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://engineering.fb.com/2014/02/20/open-source/under-the-hood-building-and-open-sourcing-fbthrift/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/facebook/fbthrift" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/data-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Data Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/cookie-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cookie Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/fbthrift/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/fbthrift/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></a></div><div class="footer__copyright">Copyright © 2022 Facebook, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/fbthrift/assets/js/runtime~main.18b8a5ef.js"></script>
<script src="/fbthrift/assets/js/main.8d55481e.js"></script>
</body>
</html>