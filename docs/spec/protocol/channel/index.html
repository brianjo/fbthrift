<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-spec/protocol/channel">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Channels | Facebook Thrift</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.internalfb.com/fbthrift/docs/spec/protocol/channel"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Channels | Facebook Thrift"><meta data-rh="true" name="description" content="The channel is the interface to Thrift RPC in each target language. While channels exist on both client and server, the term by itself commonly refers to the client channel. Here, the client and server are the two parties to the RPC where the client is the initiator."><meta data-rh="true" property="og:description" content="The channel is the interface to Thrift RPC in each target language. While channels exist on both client and server, the term by itself commonly refers to the client channel. Here, the client and server are the two parties to the RPC where the client is the initiator."><link data-rh="true" rel="icon" href="/fbthrift/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.internalfb.com/fbthrift/docs/spec/protocol/channel"><link data-rh="true" rel="alternate" href="https://www.internalfb.com/fbthrift/docs/spec/protocol/channel" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.internalfb.com/fbthrift/docs/spec/protocol/channel" hreflang="x-default"><link rel="stylesheet" href="/fbthrift/assets/css/styles.afc07cdd.css">
<link rel="preload" href="/fbthrift/assets/js/runtime~main.18b8a5ef.js" as="script">
<link rel="preload" href="/fbthrift/assets/js/main.8d55481e.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/fbthrift/"><div class="navbar__logo"><img src="/fbthrift/img/logo.svg" alt="Facebook Thrift Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/fbthrift/img/logo.svg" alt="Facebook Thrift Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Facebook Thrift</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/fbthrift/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/fbthrift" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fbthrift/docs/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fbthrift/docs/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/fbthrift/docs/spec/">Specification</a><button aria-label="Toggle the collapsible sidebar category &#x27;Specification&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fbthrift/docs/spec/about">Specification Format</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fbthrift/docs/spec/conformance/">Conformance</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/fbthrift/docs/spec/definition/">Definitions</a><button aria-label="Toggle the collapsible sidebar category &#x27;Definitions&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fbthrift/docs/spec/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fbthrift/docs/spec/idl">Interface Definition Language (IDL)</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/fbthrift/docs/spec/protocol/">Protocols</a><button aria-label="Toggle the collapsible sidebar category &#x27;Protocols&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/fbthrift/docs/spec/protocol/channel">Channels</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/fbthrift/docs/spec/protocol/data">Data Protocols</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/fbthrift/docs/spec/protocol/interface/">Interface Protocols</a><button aria-label="Toggle the collapsible sidebar category &#x27;Interface Protocols&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/fbthrift/docs/guide/">User Guide</a><button aria-label="Toggle the collapsible sidebar category &#x27;User Guide&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/fbthrift/docs/experimental/">Experimental Features</a><button aria-label="Toggle the collapsible sidebar category &#x27;Experimental Features&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/fbthrift/docs/beta/">Beta Features</a><button aria-label="Toggle the collapsible sidebar category &#x27;Beta Features&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/fbthrift/docs/cpp/">C++</a><button aria-label="Toggle the collapsible sidebar category &#x27;C++&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/fbthrift/docs/internals/">Internals</a><button aria-label="Toggle the collapsible sidebar category &#x27;Internals&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fbthrift/docs/troubleshooting">Troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fbthrift/docs/debugging">Debugging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fbthrift/docs/references/">References</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fbthrift/docs/releases">Releases</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fbthrift/docs/contribution-guide">Contribution Guide</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Channels</h1><p>The <em>channel</em> is the interface to Thrift RPC in each target language. While channels exist on both client and server, the term by itself commonly refers to the client channel. Here, the client and server are the two parties to the RPC where the client is the initiator.
A client channel is bound to a conceptual group of server channels that can respond to RPCs (e.g. a service or library instance). There may or may not be one or more remote hosts that requests can be routed to, or an in-process handler. An interface may return a client channel (by adapting a struct with instructions for creating it) to delegate future RPCs to a different service.
The concept of a channel does not have any relation to TCP or other connections to the server. Channel implementations might own or share ownership of one or several connections, might own no connections (opening them as needed or using an external pool), or might be communicating to an in-memory server without any connections involved.</p><h1>Client channel</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="structure">Structure<a class="hash-link" href="#structure" title="Direct link to heading">​</a></h2><p>Users of a thrift service typically interact with a “generated client”, which is a native object in each target language on which service methods are called in a strongly-typed way. To avoid confusion, this document will call this “generated client” a <em>typed client channel</em>. The typed channel is a friendly interface that allows the target language to typecheck, autocomplete, and otherwise provide developer functionality. It <strong>should</strong> wrap an <em>untyped client channel</em>, which is a class responsible for implementing the mechanics of RPC. The typed channel is just responsible for type erasure via serializing the arguments and method info and deserializing the response and for interfacing with the native asynchrony primitives. Following this structure provides the best experience for users of the thrift implementation while minimizing the complexity of the generated code. Further, target language implementations of the <em>untyped client channel</em> <strong>should</strong> wrap the <a href="/fbthrift/docs/cpp/channel">C++ implementation</a> whenever technically feasible, as direct implementation is involved and carries a significant ongoing maintenance burden.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="interface">Interface<a class="hash-link" href="#interface" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="typed-channel">Typed channel<a class="hash-link" href="#typed-channel" title="Direct link to heading">​</a></h3><p>The typed channel is responsible for the core abstraction of RPC, namely that the client is calling a regular method in its native language. It should be a native class/object with one or more methods corresponding to each method in the service.
Each method may have multiple overloads for supporting the optional RpcOptions argument and different asynchrony models (including blocking if desired). The target language’s idiomatic awaitable type should be used in at least one of the options, when applicable.
The methods should have an argument list that corresponds to that of the method in the IDL, accepting native and generated types.
The typed channel must support four kinds of methods. The return types are specified below, using the following placeholders:</p><ul><li>ResponseType, PayloadType, FinalResponseType: data types</li><li>Awaitable: the target language&#x27;s native primitive for asynchronous return values (e.g. Future, Awaitable)</li><li>Generator: the target language&#x27;s native primitive for asynchronous streams of values (e.g. AsyncGenerator, Flowable)</li></ul><ol><li>Request-response: Awaitable‹ResponseType›</li><li>Request-no-response: Awaitable‹void› completed when the request is sent or enqueued for sending. May also return void synchronously when only enqueuing is known and is always synchronous.</li><li>Stream: Awaitable‹ResponseType, Generator‹PayloadType››
This kind of method behaves like a request-response RPC that returns a generator of values alongside the initial response. This generator asynchrously produces values until either the client cancels the stream or the server completes it.
This native primitive must expose a mechanism for requesting cancellation (e.g. destruction or a method call).
The stream is flow-controlled on a payload basis, and the native primitive should support propagating backpressure from the application level by requesting more payloads as the application consumes its internal buffer.</li><li>Sink: Awaitable‹ResponseType, (Generator‹PayloadType›→Awaitable‹FinalResponseType›)›
This kind of method behaves like a request-response RPC that returns a (functor that accepts a generator of values and asynchronously returns an additional response) alongside the initial response.
The caller passes its generator (again a native primitive like AsyncGenerator or Flowable) to the functor, which drives the generator and sends the produced payloads to the server until the generator completes or the server sends its final response. When the final response is received before the generator completes, the generator is destroyed without being completed.
The stream is flow-controlled on a payload basis, and the functor (part of the Thrift implementation in the target language) is responsible for respecting this flow control.</li></ol><p>Metadata / headers may be attached to any payload in any of these requests.
Any of these method kinds except oneway / request-no-response can also create <a href="#interactions">Interactions</a></p><p>The typed channel’s methods should arguments corresponding to those declared in the IDL, as well as an optional first argument of type <a href="#rpcoptions">RpcOptions</a> which the typed channel copies and sets the interaction id on if applicable and passes through to the untyped channel.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="untyped-channel">Untyped channel<a class="hash-link" href="#untyped-channel" title="Direct link to heading">​</a></h3><p>The untyped channel has a structure corresponding to this schema:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">service UntypedChannel {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  binary sendRequestResponse(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    1: RpcOptions options,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    2: RequestRpcMetadata metadata,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    3: binary serializedRequest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  oneway void sendRequestNoResponse(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    1: RpcOptions options,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    2: RequestRpcMetadata metadata,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    3: binary serializedRequest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  binary, stream&lt;binary&gt; sendRequestStream(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    1: RpcOptions options,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    2: RequestRpcMetadata metadata,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    3: binary serializedRequest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  binary, sink&lt;binary, binary&gt; sendRequestSink(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    1: RpcOptions options,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    2: RequestRpcMetadata metadata,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    3: binary serializedRequest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  InteractionId createInteraction(1: string name)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  void terminateInteraction(1: InteractionId id)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Implementations have freedom with bridging to their language&#x27;s async primitives. For example, all methods in C++ return void and take a callback parameter that receives the return type.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="rpcoptions">RpcOptions<a class="hash-link" href="#rpcoptions" title="Direct link to heading">​</a></h4><p>Existing implementations use this to set some per-request options like timeouts and stream buffer size. Unless using <a href="#interactions">Interactions</a>, all fields are optional. Potentially relevant fields are documented <a href="https://github.com/facebook/fbthrift/blob/main/thrift/lib/cpp2/async/RpcOptions.h" target="_blank" rel="noopener noreferrer">inline</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="metadata">Metadata<a class="hash-link" href="#metadata" title="Direct link to heading">​</a></h4><p>Documented <a href="https://github.com/facebook/fbthrift/blob/main/thrift/lib/thrift/RpcMetadata.thrift" target="_blank" rel="noopener noreferrer">inline</a>
Note the first few fields are mandatory:</p><ul><li>Protocol used to serialize the request body (compact/binary)</li><li>Compression used on serialized request, if applicable (zlib / zstd)</li><li>Method name and kind</li></ul><p>Common other fields:</p><ul><li>timeouts (queue and overall)</li><li>unstructured headers (string to string map)</li><li>checksum</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="serializedrequest">SerializedRequest<a class="hash-link" href="#serializedrequest" title="Direct link to heading">​</a></h4><p>Method arguments wrapped in an anonymous struct and serialized as described in the <a href="/fbthrift/docs/spec/protocol/interface/#serialization-details">interface spec</a>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="response">Response<a class="hash-link" href="#response" title="Direct link to heading">​</a></h4><p>A serialized response is received for all methods except oneway (including void-returning methods) that may contain a serialized representation of the declared response type, one of the exceptions declared in the <code>throws</code> list of the method, or a <code>TApplicationException</code> for undeclared exceptions. In case of exception, the following information will be placed in the unstructured response headers:</p><ul><li>‘ex’ : an error code from <a href="https://github.com/facebook/fbthrift/blob/main/thrift/lib/cpp2/async/ResponseChannel.cpp" target="_blank" rel="noopener noreferrer">this list</a></li><li>‘uex’: the type name of the exception</li><li>‘uexw’: a description of the exception</li></ul><p>If the exception comes from the second hop of a proxied request a ‘p’ is prepended to these magic keys.</p><p>The content of the serialized response is described in the <a href="/fbthrift/docs/spec/protocol/interface/#response">interface spec</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="interactions">Interactions<a class="hash-link" href="#interactions" title="Direct link to heading">​</a></h2><p>A method can create an interaction and then behaves like one of the four other method kinds. It returns an interaction handle, which is a typed channel that also owns the interaction. Destroying or disposing of this handle sends a signal to the server that terminates the interaction, allowing it to free resources.
One of the design goals of interactions is that it is possible to complete the entire lifecycle in a single round trip. The untyped interface permits sending requests on and then terminating the interaction before the response is received; this is why IDs are client-generated. Languages in which performance-sensitive applications are written will likely want to support returning the interaction handle alongside the <!-- -->[first]<!-- --> response of the method and immediately (e.g. <code>(Awaitable‹InteractionHandle, ResponseStruct›)</code> and <code>(InteractionHandle, Awaitable‹ResponseStruct›)</code>. respectively) in their typed channel. Otherwise, the first structure is generally considered simpler.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ordering">Ordering<a class="hash-link" href="#ordering" title="Direct link to heading">​</a></h2><p>Multiple requests sent over one channel are not ordered with one another. Requests sent in a single interaction are ordered with one another, but responses (including stream payloads) are not ordered with those for other requests in the same interaction. The payloads of a single stream are ordered.</p><h1>Server channel</h1><p>Implementations <strong>should</strong> similarly generate a typed server channel interface in the target language using native types and asynchrony that is called into by an untyped channel. The details here are still in active development, as the server team comes up with an architecture that minimizes the implementation burden of non-C++ servers via an in-process or IPC server proxy. The server channel interface in C++ is currently called AsyncProcessorFactory.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/fbthrift/blob/main/thrift/website/../doc/spec/protocol/channel.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/fbthrift/docs/spec/protocol/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Protocols</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/fbthrift/docs/spec/protocol/data"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Data Protocols</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#structure" class="table-of-contents__link toc-highlight">Structure</a></li><li><a href="#interface" class="table-of-contents__link toc-highlight">Interface</a><ul><li><a href="#typed-channel" class="table-of-contents__link toc-highlight">Typed channel</a></li><li><a href="#untyped-channel" class="table-of-contents__link toc-highlight">Untyped channel</a></li></ul></li><li><a href="#interactions" class="table-of-contents__link toc-highlight">Interactions</a></li><li><a href="#ordering" class="table-of-contents__link toc-highlight">Ordering</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/fbthrift/docs/">Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/thrift" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://engineering.fb.com/2014/02/20/open-source/under-the-hood-building-and-open-sourcing-fbthrift/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/facebook/fbthrift" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/data-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Data Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/cookie-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cookie Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/fbthrift/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/fbthrift/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></a></div><div class="footer__copyright">Copyright © 2022 Facebook, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/fbthrift/assets/js/runtime~main.18b8a5ef.js"></script>
<script src="/fbthrift/assets/js/main.8d55481e.js"></script>
</body>
</html>